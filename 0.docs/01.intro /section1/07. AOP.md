# AOP가 필요한 상황

AOP(Aspect-Oriented Programming, 관점 지향 프로그래밍)는 애플리케이션의 여러 계층에 걸쳐 있는 관심사를 처리할 때 사용된다. 일반적으로 로깅, 트랜잭션 관리, 보안과 같이 애플리케이션의 여러 지점에 걸쳐 있는 공통 기능을 캡슐화하기 위해 사용된다.

## 핵심 사항

- **모든 메소드의 호출 시간을 측정하고 싶을 때:** 모든 메소드에 시간 측정 코드를 추가하는 대신, AOP를 사용하면 이러한 행위를 한 번 정의하고 필요한 곳에 적용할 수 있다.
- **공통 관심 사항(cross-cutting concern) vs 핵심 관심 사항(core concern):** AOP는 애플리케이션의 여러 부분에 영향을 미치는 관점(공통 관심 사항)과 핵심 비즈니스 로직(핵심 관심 사항) 사이의 차이를 구분하는 데 도움을 준다.
- **회원 가입 시간, 회원 조회 시간을 측정하고 싶을 때:** 회원 등록 및 조회와 관련된 메소드에만 시간 측정 관련 Aspect를 정의하고 적용함으로써 비즈니스 로직에 시간 측정 코드를 섞지 않고도 원하는 기능을 구현할 수 있다.

## 스프링 컨테이너

제공된 다이어그램에서는 전형적인 스프링 애플리케이션 레이아웃을 보여준다:
- `memberController` -> `memberService` -> `memberRepository`

이는 요청이 `memberController`로 들어와 `memberService`에 의해 처리되고, 그 다음 `memberRepository`를 통해 데이터에 접근하거나 영속화하는 흐름을 나타낸다. AOP는 이 흐름의 어떤 지점에서도 호출을 가로채 추가적인 행동(예: 로깅이나 트랜잭션 관리)을 추가하기 위해 적용될 수 있다.

## 문제

- 회원가입, 회원 조회에 시간을 측정하는 기능은 핵심 관심 사항이 아니다. 
- 시간을 측정하는 로직은 공통 관심 사항이다. 
- 시간을 측정하는 로직과 핵심 비즈니스의 로직이 섞여서 유지보수가 어렵다. 
- 시간을 측정하는 로직을 별도의 공통 로직으로 만들기 매우 어렵다.
- 시간을 측정하는 로직을 변경할 때 모든 로직을 찾아가면서 변경해야 한다.

# AOP 정의

- AOP: 관점 지향 프로그래밍
- 공통 관심 사항(가로질러 발생하는 관심사, cross-cutting concern)과 핵심 관심 사항(주요 비즈니스 로직, core concern) 분리

## 스프링 컨테이너와 AOP

스프링 컨테이너에서 `memberController`, `memberService`, `memberRepository`로 이어지는 흐름이 있을 때, AOP를 사용하면 특정 관심사를 모듈화하여 중복 없이 재사용할 수 있다. 예를 들어, `TimeTraceApp`이라는 시간 측정 관심사는 위 세 컴포넌트의 흐름에 걸쳐서만 적용되어, 각 컴포넌트의 처리 시간을 측정하고 로깅할 수 있다. 이 방법을 통해 핵심 로직 코드를 수정하지 않고도 필요한 기능을 추가할 수 있다.


## 해결

- 회원가입, 회원 조회등 핵심 관심사항과 시간을 측정하는 공통 관심 사항을 분리한다. 시
- 간을 측정하는 로직을 별도의 공통 로직으로 만들었다. 
- 핵심 관심 사항을 깔끔하게 유지할 수 있다. 
- 변경이 필요하면 이 로직만 변경하면 된다. 
- 원하는 적용 대상을 선택할 수 있다.


# AOP 적용 전후

## AOP 적용 전
기본적인 스프링 컨테이너에서는 `memberController`가 `memberService`를 호출하는 
직접적인 흐름을 가집니다.

## AOP 적용 후 개별적
AOP를 적용하면, `memberController`와 `memberService` 사이에
`TimeTraceApp`이라는 AOP 프록시가 위치하여 실제 `memberService`가 호출되기 전후로 특정 로직(시간 추적 로직)을 실행할 수 있습니다. 이는 `joinPoint.proceed()` 메소드를 통해 관리됩니다.

## AOP 적용 후 전체 흐름
전체 애플리케이션 흐름에서 `memberController`, `memberService`, `memberRepository` 각각에 AOP 프록시가 적용될 수 있습니다. 이렇게 AOP를 통해 각 컴포넌트의 호출 전후로 추가적인 로직을 삽입할 수 있으며, 이는 흐름을 방해하지 않으면서도 필요한 기능을 추가할 수 있는 강력한 방법을 제공합니다.



