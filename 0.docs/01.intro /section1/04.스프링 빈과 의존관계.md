# 컴포넌트 스캔과 자동 의존관계 설정

회원 컨트롤러가 회원서비스와 회원 리포지터리를 사용할 수 있게 의존관계를 준비하자.

## 회원 컨트롤러에 의존관계 추가동 의존관계 설₩

- 생성자에 `@Autowired` 가 있으면 스프링이 연관된 객체를 스프링 컨테이너에서 찾아서 넣어준다. 이렇게 객체 의존관계를 외부에서 넣어주는 것을 DI (Dependency Injection), 의존성 주입이라 한다.
- 이전 테스트에서는 개발자가 직접 주입했고, 여기서는 @Autowired에 의해 스프링이 주입해준다.

### 오류 발생

``Consider defining a bean of type 'hello.hellospring.service.MemberService' in
your configuration.``

# 스프링 컨테이너와 빈 연결 오류

`memberService`가 스프링 빈으로 등록되지 않았다는 오류 상황을 알아보자.

## 문제 상황

- `memberController`는 스프링에 의해 관리되고 있지만, `memberService`는 
스프링 빈으로 등록되지 않아 연결할 수 없다.
- 이 문제는 스프링 컨테이너에서 `memberService`를 찾을 수 없을 때 발생한다.

## 해결 방법

- `memberService`를 스프링 컨테이너에 빈으로 등록해야 한다.
- `@Controller`가 있는 클래스 내에서 `@Autowired`를 
사용하여 `memberService`를 주입받아야 한다.

## 스프링 빈을 등록하는 2가지 방법

1. 컴포넌트 스캔과 자동 의존관계 설정
2. 자바 코드로 직접 스프링 빈 등록하기

# 컴포넌트 스캔 원리

- `@Component` 애노테이션이 있으면 스프링 빈으로 자동 등록된다.
- `@Controller`는 컨트롤러가 스프링 빈으로 자동 등록되어 의존관계를 
주입받는 컴포넌트 스캔 대상이다.

- `@Component`를 포함하는 다음 애노테이션도 스프링 빈으로 자동 등록된다.
    - `@Controller`
    - `@Service`
    - `@Repository`
--- 
참고: 생성자에 `@Autowired` 를 사용하면 객체 생성 시점에 스프링 컨테이너에서 해당 스프링 빈을 찾아서 주입 한다. 
생성자가 1개만 있으면 `@Autowired` 는 생략할 수 있다.
---

# 회원 리포지토리 스프링 빈 등록

`MemoryMemberRepository` 클래스는 `MemberRepository` 인터페이스를 구현하며, 스프링의 `@Repository` 애노테이션을 사용하여 스프링 빈으로 등록되었다.

## 스프링 빈 연결 구조 설명

- `memberController` -> `memberService` -> `memberRepository` 순으로 스프링 빈이 연결되어 있다.
- `memberService`와 `memberRepository`는 스프링 컨테이너 내에서 관리되는 스프링 빈으로 등록되었다.

참고: 스프링 컨테이너는 빈을 생성할 때 기본적으로 싱글톤 패턴을 사용한다. 
즉, 하나의 인스턴스만을 생성하여 공유한다. 개발자는 필요에 따라 싱글톤이 아닌 다른 범위로 설정할 수 있으나, 
대부분의 경우 싱글톤 범위의 빈을 사용한다.

---
이제는 환경 설정에서 리포지토리를 다른 리포지토리로 바꾸려면 설정만 바꿔서 코드를 전혀 손대지 않아도 된다. 코드를 전혀 손대지 않고도 기능을 확장할 수 있다.

참고: XML로 설정하는 방식도 있지만 최근에는 잘 사용하지 않으므로 생략한다.

다음은: DI에는 필드 주입, setter 주입, 생성자 주입 이렇게 3가지 방법이 있다. 의존관계가 실행중에 동적으로 변하는 경우는 거의 없으므로 생성자 주입을 권장한다.

---

스프링은 스프링 컨테이너에 자동으로 등록된다. 컨트롤러, 서비스, 리포지토리 같은 코드는 스프링이 컨트롤한다. 그리고 강한 결합도를 가지고, 상황에 따라 구현 클래스를 변경하여 다양한 방식으로 동작시킬 수 있는 스프링 빈으로 등록한다.

주의: `@Autowired`를 통해 DI는 helloController, memberService 등과 같이 스프링이 관리하는 객체에만 적용된다. 스프링 빈으로 등록하지 않고 내가 직접 생성한 객체에는 적용되지 않는다.
