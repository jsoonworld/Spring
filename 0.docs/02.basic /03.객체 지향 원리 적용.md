# π μƒλ΅μ΄ ν• μΈ μ •μ±… κ°λ°

## π”„ λ§μ•½ μ •μ•΅ ν• μΈ μ •μ±…μ—μ„ μ •λ¥  ν• μΈ μ •μ±…μΌλ΅ λ³€κ²½λλ‹¤λ©΄?

ν• μΈ μ •μ±…μ„ λ³€κ²½ν•λ ¤λ©΄ ν΄λΌμ΄μ–ΈνΈμΈ `OrderServiceImpl` μ½”λ“λ¥Ό μμ •ν•΄μ•Ό ν•©λ‹λ‹¤.
```java
public class OrderServiceImpl implements OrderService {
 //    private final DiscountPolicy discountPolicy = new FixDiscountPolicy();
     private final DiscountPolicy discountPolicy = new RateDiscountPolicy();
}
```


## β— λ¬Έμ μ  λ°κ²¬

- μ—­ν• κ³Ό κµ¬ν„μ„ μ² μ €ν λ¶„λ¦¬ν–μµλ‹λ‹¤.
- λ‹¤ν•μ„±μ„ ν™μ©ν•κ³ , μΈν„°νμ΄μ¤μ™€ κµ¬ν„ κ°μ²΄λ¥Ό λ¶„λ¦¬ν–μµλ‹λ‹¤.
- OCP, DIPμ™€ κ°™μ€ κ°μ²΄μ§€ν–¥ μ„¤κ³„ μ›μΉ™μ„ μ λ”°λ¥Έ κ²ƒ κ°™μ§€λ§, λ¬Έμ κ°€ μμµλ‹λ‹¤.
- **DIP**: **'OrderServiceImpl'** ν΄λΌμ΄μ–ΈνΈλ” DiscountPolicy μΈν„°νμ΄μ¤μ— μμ΅΄ν•λ©° DIPλ¥Ό μ¤€μν•λ” κ²ƒμ²λΌ λ³΄μ΄μ§€λ§,
  - μ‹¤μ λ΅λ” μ¶”μƒ(μΈν„°νμ΄μ¤) λΏλ§ μ•„λ‹λΌ κµ¬μ²΄(κµ¬ν„) ν΄λμ¤μ—λ„ μμ΅΄ν•κ³  μμµλ‹λ‹¤.
  - μ¶”μƒ(μΈν„°νμ΄μ¤) μμ΅΄: **'DiscountPolicy'**
  - κµ¬μ²΄(κµ¬ν„) ν΄λμ¤: **'FixDiscountPolicy'**, **'RateDiscountPolicy'**
- **OCP**: λ³€κ²½ μ—†μ΄ ν™•μ¥μ΄ κ°€λ¥ν•΄μ•Ό ν•λ”λ°,
  - **ν„μ¬ μ½”λ“λ” κΈ°λ¥ λ³€κ²½ μ‹ ν΄λΌμ΄μ–ΈνΈ μ½”λ“μ— μν–¥**μ„ λ―ΈμΉ©λ‹λ‹¤. λ”°λΌμ„ **OCP μ„λ°**μ…λ‹λ‹¤.

## π›  μ–΄λ–»κ² λ¬Έμ λ¥Ό ν•΄κ²°ν•  μ μμ„κΉ?

- **'OrderServiceImpl'** ν΄λΌμ΄μ–ΈνΈ μ½”λ“λ” **'DiscountPolicy'** μΈν„°νμ΄μ¤λΏλ§ μ•„λ‹λΌ κµ¬μ²΄ ν΄λμ¤μ—λ„ μμ΅΄ν•κ³  μμµλ‹λ‹¤.
- κµ¬μ²΄ ν΄λμ¤λ¥Ό λ³€κ²½ν•  λ•λ§λ‹¤ ν΄λΌμ΄μ–ΈνΈ μ½”λ“λ„ λ³€κ²½ν•΄μ•Ό ν•©λ‹λ‹¤.
- **DIP μ„λ°**μ„ ν•΄κ²°ν•λ ¤λ©΄ μ¶”μƒμ—λ§ μμ΅΄ν•λ„λ΅ λ³€κ²½ν•΄μ•Ό ν•©λ‹λ‹¤(μΈν„°νμ΄μ¤μ—λ§ μμ΅΄).

## μΈν„°νμ΄μ¤μ—λ§ μμ΅΄ν•λ„λ΅ μ½”λ“ λ³€κ²½

```java
public class OrderServiceImpl implements OrderService {
     //private final DiscountPolicy discountPolicy = new RateDiscountPolicy();
     private DiscountPolicy discountPolicy;
}
```

- μΈν„°νμ΄μ¤μ—λ§ μμ΅΄ν•λ„λ΅ μ„¤κ³„μ™€ μ½”λ“λ¥Ό λ³€κ²½ν–μµλ‹λ‹¤.
- `ν•μ§€λ§ κµ¬ν„μ²΄κ°€ μ—†μΌλ©΄ μ–΄λ–»κ² μ½”λ“λ¥Ό μ‹¤ν–‰ν•  μ μμ„κΉμ”?`
- μ‹¤μ λ΅ μ‹¤ν–‰ν•λ©΄ NPE(Null Pointer Exception)κ°€ λ°μƒν•©λ‹λ‹¤.

## π’΅ ν•΄κ²°λ°©μ•

- μ΄ λ¬Έμ λ¥Ό ν•΄κ²°ν•λ ¤λ©΄ λ„κµ°κ°€κ°€ **'OrderServiceImpl'** ν΄λΌμ΄μ–ΈνΈμ— **'DiscountPolicy'** 
κµ¬ν„ κ°μ²΄λ¥Ό μƒμ„±ν•κ³  μ£Όμ…ν•΄μ£Όμ–΄μ•Ό ν•©λ‹λ‹¤.

## π­ κ΄€μ‹¬μ‚¬μ λ¶„λ¦¬

- μ• ν”λ¦¬μΌ€μ΄μ…μ„ ν•λ‚μ κ³µμ—°μΌλ΅ μƒκ°ν•΄ λ΄…μ‹λ‹¤. κ° μΈν„°νμ΄μ¤λ” λ°°μ—­(λ°°μ° μ—­ν• )μ…λ‹λ‹¤.
- λ΅λ―Έμ¤μ™€ μ¤„λ¦¬μ—£ κ³µμ—°μ—μ„ λ΅λ―Έμ¤ μ—­ν• μ„ λ„κ°€ λ§΅μ„μ§€, μ¤„λ¦¬μ—£ μ—­ν• μ„ λ„κ°€ λ§΅μ„μ§€λ” λ°°μ°λ“¤μ΄ μ •ν•μ§€ μ•μµλ‹λ‹¤.
- μ΄μ „ μ½”λ“λ” λ΅λ―Έμ¤ μ—­ν• (μΈν„°νμ΄μ¤)μ„ λ§΅μ€ λ°°μ°κ°€ μ¤„λ¦¬μ—£ μ—­ν• (μΈν„°νμ΄μ¤)μ„ λ§΅μ€ λ°°μ°λ¥Ό μ§μ ‘ μ΄λΉ™ν•λ” κ²ƒκ³Ό κ°™μµλ‹λ‹¤. λ‹¤μ–‘ν• μ±…μ„μ„ κ°€μ§€κ³  μμµλ‹λ‹¤.

## π­ κ΄€μ‹¬μ‚¬λ¥Ό λ¶„λ¦¬ν•©μ‹λ‹¤

- π¬ λ°°μ°λ” μμ‹ μ μ—­ν• μ—λ§ μ§‘μ¤‘ν•΄μ•Ό ν•©λ‹λ‹¤.
- π κ³µμ—°μ„ κµ¬μ„±ν•κ³ , λ‹΄λ‹Ή λ°°μ°λ¥Ό μ„­μ™Έν•λ©°, μ—­ν• μ— λ§λ” λ°°μ°λ¥Ό μ§€μ •ν•λ” μ±…μ„μ„ κ°€μ§„ κ³µμ—° κΈ°νμκ°€ ν•„μ”ν•©λ‹λ‹¤.
- π“ κ³µμ—° κΈ°νμλ¥Ό λ„μ…ν•κ³ , λ°°μ°μ™€ κΈ°νμμ μ±…μ„μ„ λ…ν™•ν λ¶„λ¦¬ν•©μ‹λ‹¤.

## π AppConfig λ“±μ¥

- β™οΈ μ• ν”λ¦¬μΌ€μ΄μ…μ μ „μ²΄ λ™μ‘ λ°©μ‹μ„ κµ¬μ„±(config)ν•κΈ° μ„ν•΄, **κµ¬ν„ κ°μ²΄λ¥Ό μƒμ„±**ν•κ³ , **μ—°κ²°**ν•λ” μ±…μ„μ„ κ°€μ§€λ” λ³„λ„μ μ„¤μ • ν΄λμ¤λ¥Ό λ§λ“¤μ.

- π— AppConfigλ” μ• ν”λ¦¬μΌ€μ΄μ…μ μ‹¤μ  λ™μ‘μ— ν•„μ”ν• **κµ¬ν„ κ°μ²΄λ¥Ό μƒμ„±**ν•©λ‹λ‹¤.
    - `MemberServiceImpl`
    - `MemoryMemberRepository`
    - `OrderServiceImpl`
    - `FixDiscountPolicy`
- π”— AppConfigλ” μƒμ„±ν• κ°μ²΄ μΈμ¤ν„΄μ¤μ μ°Έμ΅°(λ νΌλ°μ¤)λ¥Ό **μƒμ„±μλ¥Ό ν†µν•΄μ„ μ£Όμ…(μ—°κ²°)** ν•΄μ¤λ‹λ‹¤.
    - `MemberServiceImpl` -> `MemoryMemberRepository`
    - `OrderServiceImpl` -> `MemoryMemberRepository`, `FixDiscountPolicy`

### **MemberServiceImpl - μƒμ„±μ μ£Όμ…**
```java
package hello.core.member;

 public class MemberServiceImpl implements MemberService {
     
     private final MemberRepository memberRepository;
     
     public MemberServiceImpl(MemberRepository memberRepository) {
         this.memberRepository = memberRepository;
     }
     
     public void join(Member member) {
         memberRepository.save(member);
    }

     public Member findMember(Long memberId) {
         return memberRepository.findById(memberId);
    }
    
 }
 ```


- π”„ μ„¤κ³„ λ³€κ²½μΌλ΅ `MemberServiceImpl` μ€ `MemoryMemberRepository` λ¥Ό μμ΅΄ν•μ§€ μ•λ”λ‹¤! 
- π’΅ λ‹¨μ§€ `MemberRepository` μΈν„°νμ΄μ¤λ§ μμ΅΄ν•λ‹¤.
- π›  `MemberServiceImpl` μ…μ¥μ—μ„ μƒμ„±μλ¥Ό ν†µν•΄ μ–΄λ–¤ κµ¬ν„ κ°μ²΄κ°€ λ“¤μ–΄μ¬μ§€(μ£Όμ…λ μ§€)λ” μ• μ μ—†λ‹¤.
- π― `MemberServiceImpl` μ μƒμ„±μλ¥Ό ν†µν•΄μ„ μ–΄λ–¤ κµ¬ν„ κ°μ²΄λ¥Ό μ£Όμ…ν• μ§€λ” μ¤μ§ μ™Έλ¶€( `AppConfig` )μ—μ„ κ²°μ •λλ‹¤.
- πƒβ€β™‚οΈ MemberServiceImpl` μ€ μ΄μ λ¶€ν„° **μμ΅΄κ΄€κ³„μ— λ€ν• κ³ λ―Όμ€ μ™Έλ¶€**μ— λ§΅κΈ°κ³  **μ‹¤ν–‰μ—λ§ μ§‘μ¤‘**ν•λ©΄ λλ‹¤.


## π“ μ •λ¦¬

- π§© AppConfigλ¥Ό ν†µν•΄μ„ κ΄€μ‹¬μ‚¬λ¥Ό ν™•μ‹¤ν•κ² λ¶„λ¦¬ν–λ‹¤.
- π­ λ°°μ—­, λ°°μ°λ¥Ό μƒκ°ν•΄λ³΄μ.
- π¬ AppConfigλ” κ³µμ—° κΈ°νμλ‹¤.
- π¨ AppConfigλ” κµ¬μ²΄ ν΄λμ¤λ¥Ό μ„ νƒν•λ‹¤. λ°°μ—­μ— λ§λ” λ‹΄λ‹Ή λ°°μ°λ¥Ό μ„ νƒν•λ‹¤. μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ–΄λ–»κ² λ™μ‘ν•΄μ•Ό ν•  μ§€ μ „μ²΄ κµ¬μ„±μ„ μ±…μ„μ§„λ‹¤.
- π― μ΄μ  κ° λ°°μ°λ“¤μ€ λ‹΄λ‹Ή κΈ°λ¥μ„ μ‹¤ν–‰ν•λ” μ±…μ„λ§ μ§€λ©΄ λλ‹¤.
- πƒβ€β™‚οΈ `OrderServiceImpl` μ€ κΈ°λ¥μ„ μ‹¤ν–‰ν•λ” μ±…μ„λ§ μ§€λ©΄ λλ‹¤.

## μ¤ν”„λ§μΌλ΅ μ „ν™ν•κΈ°

- AppConfigμ— μ„¤μ •μ„ κµ¬μ„±ν•λ‹¤λ” λ»μ `@Configuration` μ„ λ¶™μ—¬μ¤€λ‹¤.
- κ° λ©”μ„λ“μ— `@Bean` μ„ λ¶™μ—¬μ¤€λ‹¤. μ΄λ ‡κ² ν•λ©΄ μ¤ν”„λ§ μ»¨ν…μ΄λ„μ— μ¤ν”„λ§ λΉμΌλ΅ λ“±λ΅ν•λ‹¤.

## **μ¤ν”„λ§ μ»¨ν…μ΄λ„**
- ApplicationContext` λ¥Ό μ¤ν”„λ§ μ»¨ν…μ΄λ„λΌ ν•λ‹¤.
- κΈ°μ΅΄μ—λ” κ°λ°μκ°€ `AppConfig` λ¥Ό μ‚¬μ©ν•΄μ„ μ§μ ‘ κ°μ²΄λ¥Ό μƒμ„±ν•κ³  DIλ¥Ό ν–μ§€λ§, μ΄μ λ¶€ν„°λ” μ¤ν”„λ§ μ»¨ν…μ΄λ„λ¥Ό ν†µν•΄μ„ μ‚¬μ©ν•λ‹¤.
- μ¤ν”„λ§ μ»¨ν…μ΄λ„λ” `@Configuration` μ΄ λ¶™μ€ `AppConfig` λ¥Ό μ„¤μ •(κµ¬μ„±) μ •λ³΄λ΅ μ‚¬μ©ν•λ‹¤. μ—¬κΈ°μ„ `@Bean` μ΄ λΌ μ ν λ©”μ„λ“λ¥Ό λ¨λ‘ νΈμ¶ν•΄μ„ λ°ν™λ κ°μ²΄λ¥Ό μ¤ν”„λ§ μ»¨ν…μ΄λ„μ— λ“±λ΅ν•λ‹¤. μ΄λ ‡κ² μ¤ν”„λ§ μ»¨ν…μ΄λ„μ— λ“±λ΅λ κ°μ²΄λ¥Ό μ¤ν”„λ§ λΉμ΄λΌ ν•λ‹¤.
- μ¤ν”„λ§ λΉμ€ `@Bean` μ΄ λ¶™μ€ λ©”μ„λ“μ λ…μ„ μ¤ν”„λ§ λΉμ μ΄λ¦„μΌλ΅ μ‚¬μ©ν•λ‹¤. ( `memberService` ,`orderService` )
- μ΄μ „μ—λ” κ°λ°μκ°€ ν•„μ”ν• κ°μ²΄λ¥Ό `AppConfig` λ¥Ό μ‚¬μ©ν•΄μ„ μ§μ ‘ μ΅°νν–μ§€λ§, μ΄μ λ¶€ν„°λ” μ¤ν”„λ§ μ»¨ν…μ΄λ„λ¥Ό ν†µ ν•΄μ„ ν•„μ”ν• μ¤ν”„λ§ λΉ(κ°μ²΄)λ¥Ό μ°Ύμ•„μ•Ό ν•λ‹¤. μ¤ν”„λ§ λΉμ€ `applicationContext.getBean()` λ©”μ„λ“λ¥Ό μ‚¬μ© ν•΄μ„ μ°Ύμ„ μ μλ‹¤.
- κΈ°μ΅΄μ—λ” κ°λ°μκ°€ μ§μ ‘ μλ°”μ½”λ“λ΅ λ¨λ“  κ²ƒμ„ ν–λ‹¤λ©΄ μ΄μ λ¶€ν„°λ” μ¤ν”„λ§ μ»¨ν…μ΄λ„μ— κ°μ²΄λ¥Ό μ¤ν”„λ§ λΉμΌλ΅ λ“±λ΅ ν•κ³ , μ¤ν”„λ§ μ»¨ν…μ΄λ„μ—μ„ μ¤ν”„λ§ λΉμ„ μ°Ύμ•„μ„ μ‚¬μ©ν•λ„λ΅ λ³€κ²½λμ—λ‹¤.